<?xml version="1.0"?>
<openerp>
    <data>
        <record model="ir.ui.view" id="view_sale_order_telegram_message_form_view">
            <field name="name">Messaggio Telegram</field>
            <field name="model">sale.order</field>
            <field name="priority" eval="40"/>
            <field name="arch" type="xml">
                <form string="Messaggio Telegram" version="7.0">
                    <group col="4" colspan="4">
                        <separator string="Messaggio di Telegram" colspan="4"/>
                        <field name="telegram_message" colpan="4" nolabel="1" />
                    </group>
                    <footer>
                        <button name="action_button_send_message_telegram_note" string="Invia messaggio" type="object" icon="gtk-index" />
                    </footer>
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="view_sale_order_extra_discount_note_form_view">
            <field name="name">Note extra sconto</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form" />
            <field name="arch" type="xml">
                <xpath expr="//notebook" position="inside">
                    <page name="extra_discount_page" string="Extra sconti">
                        <group col="4" colspan="4">
                            <separator string="Note sconti extra:" colspan="4" />
                            <field name="extra_discount_detail" nolabel="1" colpan="4"/>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>
        <record model="ir.ui.view" id="view_order_saw_buttontree">
            <field name="name">Visto</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree" />
            <field name="arch" type="xml">
                <field name="name" position="after">
                    <field name="request_approvation" invisible="1"/>
                    <button name="set_request_approvation_true" string="Visto!" invisible="not context.get('saw_mode')"
                            attrs="{'invisible': [('request_approvation', '=', False)]}" groups="sale_quotation_approvation.group_sale_order_approvation_manager"
                            icon="gtk-apply" type="object" />
                </field>
            </field>
        </record>

        <record model="ir.ui.view" id="view_sale_order_approve_button_form_view">
            <field name="name">Approve button</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form" />
            <field name="arch" type="xml">
                <button name="action_button_confirm" position="before">
                    <button name="action_button_add_telegram_note" string="Nota Telegram" type="object" icon="gtk-index" />
                    <button name="action_button_request_approve" string="Richiesta approvazione"
                        type="object" icon="gtk-help"
                        attrs="{'invisible': ['|', ('request_approvation', '=', True), ('state', 'not in', ('draft', 'sent'))]}"/>
                    <button name="action_button_request_approve_deny" string="Non approvato"
                        type="object" icon="gtk-no"
                        attrs="{'invisible': [('request_approvation', '=', False)]}"/> <!-- if approved mode 2 change setup for confirmed order -->
                    <field name="request_approvation" invisible="1"/>
                </button>
            </field>
        </record>
        <record id="sale_order_approve_action" model="ir.actions.act_window">
            <field name="name">Richiesta approvazione</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state', 'in', ('draft', 'sent')), ('request_approvation', '=', True)]</field>
        </record>
        <record id="sale_order_saw_action" model="ir.actions.act_window">
            <field name="name">Richiesta vistatura</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'saw_mode': True}</field>
            <field name="domain">[('state', 'not in', ('draft', 'sent', 'cancel')), ('request_approvation', '=', True)]</field>
        </record>

        <!-- This Menu Item must have a parent and an action -->
        <menuitem id="menu_sale_order_approve"
              groups="sale_quotation_approvation.group_sale_order_approvation_manager,sale_quotation_approvation.group_sale_order_approvation_user"
              name="Offerte da approvare" parent="base.menu_sales" action="sale_order_approve_action" sequence="5"/>
        <menuitem id="menu_sale_order_saw"
              groups="sale_quotation_approvation.group_sale_order_approvation_manager"
              name="Ordini da vistare" parent="base.menu_sales" action="sale_order_saw_action" sequence="5"/>
    </data>
</openerp>

